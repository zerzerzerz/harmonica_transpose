# 口琴谱调号转换器 (Harmonica Transpoter)

这是一个用于口琴简谱调号转换的 Python 工具。它可以将一份以某个调（如 C 调）标记的谱子，转换为另一个调（如 D 调）的记谱方式，同时保持实际发音高度不变。

## 功能特点

- **多调性支持**：支持 C, C#, Db, D, Eb, E, F, F#, G, Ab, A, Bb, B 等所有常见调号。
- **符号解析**：
    - `#1` ~ `#7`：升半音。
    - `b1` / `♭1`：降半音。
    - `(1)` / `（1）`：低八度标记（支持中英文括号自动识别）。
    - `[1]` / `【1】`：高八度标记（支持中英文括号自动识别）。
- **智能重标记 (Re-labeling)**：核心逻辑是保持**实际物理音高不变**。例如 C 调的 `3` (E音)，在 D 调中会被重新标记为 `2` (D大调的第2级)。
- **文件输出**：支持将转换结果保存到指定文件。
- **异常字符预警**：自动识别谱子中无法解析为音符的字符并发出警告，支持将警告日志保存为文件。

## 安装

无需安装，只需确保您的系统中安装了 Python 3。

```bash
# 下载脚本后即可运行
python harmonica_transpose.py --help
```

## 使用方法

### 基础用法

将 C 调谱子转换为 D 调并在屏幕显示：

```bash
python harmonica_transpose.py -i input.txt --target D
```

### 保存到文件

使用 `-o` 参数指定输出文件：

```bash
python harmonica_transpose.py -i input.txt --target G -o output.txt
```

### 指定源调号

如果原始谱子不是 C 调（例如是 G 调谱）：

```bash
# 将 G 调谱子转换为 D 调表示
python harmonica_transpose.py -i input.txt --target D --source G
```

### 记录警告信息

将无法识别的字符记录到日志文件中：

```bash
python harmonica_transpose.py -i input.txt --target D -w warnings.log
```

### 参数说明

| 参数         | 缩写 | 描述         | 备注                                   |
| :----------- | :--- | :----------- | :------------------------------------- |
| `--input`    | `-i` | 输入内容     | 可以是文件路径，也可以是单纯的谱子文本 |
| `--target`   |      | 目标调号     | 如 D, F#, Bb (必填)                    |
| `--source`   | `-s` | 源调号       | 默认为 C                               |
| `--output`   | `-o` | 输出文件路径 | 若不指定则打印到屏幕                   |
| `--warnings` | `-w` | 警告日志路径 | 记录无法解析的字符及其编码             |

## 示例

**输入 (C 调):**
`332#4 (6)2335#4`

**命令:**
`python harmonica_transpose.py -i "332#4 (6)2335#4" --target D`

**输出 (D 调):**
`2213 (5)12243`

## 注意事项

- 程序采用递归解析，支持括号嵌套。
- 空格、换行以及 `0`, `8`, `9`, `=`, `-`, `|` 等常用乐谱辅助符号默认会被保留且不触发警告。
- 建议使用标准 UTF-8 编码的文件。
